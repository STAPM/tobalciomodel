View(duties)
duties[, perlitres := ifelse(is.na(dutyperlitre) ,0,1)]
View(duties)
duties[, of_product := ifelse(how_applied == "per litre of product" ,0,1)]
View(duties)
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties <- cbind(duties_data,changes)
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
View(duties)
litres <- 100
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[perlitres == 1 & of_product == 1, new_duty := (1 + dutyperlitre)/(litres*(100*abv))]
View(duties)
duties[perlitres == 1 & of_product == 1, new_duty := (changes + dutyperlitre)/(litres*(100*abv))]
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
litres <- 100
# apply the changes in duty per litre of product
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[perlitres == 1 & of_product == 1, new_duty := (changes + dutyperlitre)/(litres*(100*abv))]
View(duties)
duties[,n := changes + dutyperlitre]
View(duties)
41.38/(4.5*100)
duties[perlitres == 1 & of_product == 1, new_duty := (dutyperlitre)/(litres*(100*abv))]
View(duties)
duties[perlitres == 1 & of_product == 1, new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
View(duties)
0.01*40.38
40
40.38+0.4038
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
View(duties)
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres)]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
litres <- 100
# apply the changes in duty per litre of product
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1 & of_product == 1, new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
litres <- 100
# apply the changes in duty per litre of product
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1 & of_product == 1, new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
View(duties)
0.0842+8.42
duties <- duties[,c("product","duty","new_duty","marketshare")]
View(duties)
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
View(duties)
alc <- alcohol_data[alcohol_data$year == select_year,c("product","price","units_total")]
names(alcohol)data
names(alcohol_data)
alc <- alcohol_data[alcohol_data$year == select_year,]
View(alc)
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
View(duties)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres*(100)]
# apply changes in duty
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
duties <- duties[,c("product","duty","new_duty","marketshare")]
#### create a product level dataset of duty data
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
View(duties)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres*(100)]
# apply changes in duty
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
duties <- duties[,c("product","duty","new_duty","marketshare")]
#### create a product level dataset of duty data
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
View(duties)
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*(100*abv))]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres*(100)]
View(duties)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
duties[, dutyperlitre := dutyperlitre/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*abv)]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
View(duties)
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
duties <- duties[,c("product","duty","new_duty","marketshare")]
View(duties)
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
View(duties)
names(alc)
long <- melt.data.table(data_weighted,
id.vars = idvars,
measure.vars = list(c("units_off_beer", "units_off_cider", "units_off_wine", "units_off_spirits", "units_off_rtds",
"units_on_beer" , "units_on_cider" , "units_on_wine" , "units_on_spirits" ,"units_on_rtds"),
c("price_off_beer", "price_off_cider", "price_off_wine", "price_off_spirits", "price_off_rtds",
"price_on_beer" , "price_on_cider" , "price_on_wine" , "price_on_spirits" ,"price_on_rtds")
),
variable.name = "product",
value.name = c("units","price"))
long <- melt.data.table(alc,
id.vars = idvars,
measure.vars = list(c("units_off_beer", "units_off_cider", "units_off_wine", "units_off_spirits", "units_off_rtds",
"units_on_beer" , "units_on_cider" , "units_on_wine" , "units_on_spirits" ,"units_on_rtds"),
c("price_off_beer", "price_off_cider", "price_off_wine", "price_off_spirits", "price_off_rtds",
"price_on_beer" , "price_on_cider" , "price_on_wine" , "price_on_spirits" ,"price_on_rtds")
),
variable.name = "product",
value.name = c("units","price"))
long <- melt.data.table(alc,
id.vars = year,
measure.vars = list(c("units_off_beer", "units_off_cider", "units_off_wine", "units_off_spirits", "units_off_rtds",
"units_on_beer" , "units_on_cider" , "units_on_wine" , "units_on_spirits" ,"units_on_rtds"),
c("price_off_beer", "price_off_cider", "price_off_wine", "price_off_spirits", "price_off_rtds",
"price_on_beer" , "price_on_cider" , "price_on_wine" , "price_on_spirits" ,"price_on_rtds")
),
variable.name = "product",
value.name = c("units","price"))
long <- melt.data.table(alc,
id.vars = "year",
measure.vars = list(c("units_off_beer", "units_off_cider", "units_off_wine", "units_off_spirits", "units_off_rtds",
"units_on_beer" , "units_on_cider" , "units_on_wine" , "units_on_spirits" ,"units_on_rtds"),
c("price_off_beer", "price_off_cider", "price_off_wine", "price_off_spirits", "price_off_rtds",
"price_on_beer" , "price_on_cider" , "price_on_wine" , "price_on_spirits" ,"price_on_rtds")
),
variable.name = "product",
value.name = c("units","price"))
View(long)
names(duties)
View(duties)
names(duties)
long[, product := factor(product,
values = c(1:10),
labels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
long[, product := factor(product,
levels = c(1:10),
labels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
View(long)
View(long)
View(duties)
merge1 <- merge.data.table(long,duties,by = "product")
View(elasticities_data)
elasticities_data <- elasticities_data[cross == "Yes",-c("cross")]
View(elasticities_data)
elasticities_data <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
elasticities_data = tobalciomodel::data_elasticities
elasticities_data <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
View(elasticities_data)
merge1[,duty_prop := duty_per_unit/price]
merge1[,prop_ch_price := duty_prop*(ch_duty_per_unit/duty_per_unit)]
prop_ch_price <- as.matrix(merge1$prop_ch_price)
elasticities_data = tobalciomodel::data_elasticities
elasticities <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
prop_ch_cons  <- elasticities %*% prop_ch_price
View(prop_ch_cons)
merge2 <- data.table(merge1,prop_ch_cons)
View(merge2)
View(merge2)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
duties[, dutyperlitre := dutyperlitre/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*abv)]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
# apply changes in duty
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
duties <- duties[,c("product","duty","new_duty","marketshare")]
#### create a product level dataset of duty data
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
duties[, product := factor(product,
levels = c(1:10),
labels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
View(duties)
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
duties[, dutyperlitre := dutyperlitre/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*abv)]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
# apply changes in duty
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
duties <- duties[,c("product","duty","new_duty","marketshare")]
#### create a product level dataset of duty data
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
duties[, product := factor(product,
levels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
View(duties)
alc <- alcohol_data[alcohol_data$year == select_year,]
#### reshape into long form
long <- melt.data.table(alc,
id.vars = "year",
measure.vars = list(c("units_off_beer", "units_off_cider", "units_off_wine", "units_off_spirits", "units_off_rtds",
"units_on_beer" , "units_on_cider" , "units_on_wine" , "units_on_spirits" ,"units_on_rtds"),
c("price_off_beer", "price_off_cider", "price_off_wine", "price_off_spirits", "price_off_rtds",
"price_on_beer" , "price_on_cider" , "price_on_wine" , "price_on_spirits" ,"price_on_rtds")
),
variable.name = "product",
value.name = c("units","price"))
long[, product := factor(product,
levels = c(1:10),
labels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
View(long)
View(duties)
merge1 <- merge.data.table(long,duties,by = "product")
View(merge1)
elasticities <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
allow_cross <- "No"
if (allow_cross == "Yes") {
elasticities <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
} else if (allow_cross == "No") {
elasticities <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
}
if (allow_cross == "Yes") {
elasticities <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
} else if (allow_cross == "No") {
elasticities <- as.matrix(elasticities_data[cross == "No",-c("cross")])
}
# calculate duty per unit as a proportion of total price per unit
# formula for the change in price: Prop Ch Price = (duty % of price) * Prop Ch Duty
merge1[,duty_prop := duty_per_unit/price]
merge1[,prop_ch_price := duty_prop*(ch_duty_per_unit/duty_per_unit)]
# formula for the change in consumption:
#     prop Ch Cons = elasticity * Prop Ch Price
#     Ch Cons = elasticity * Prop Ch Price * Consumption
prop_ch_price <- as.matrix(merge1$prop_ch_price)
prop_ch_cons  <- elasticities %*% prop_ch_price
merge2 <- data.table(merge1,prop_ch_cons)
merge2[, ch_cons := prop_ch_cons * units_total]
View(merge2)
merge2 <- data.table(merge1,prop_ch_cons)
setnames(merge2,"V1","prop_ch_cons")
merge2[, ch_cons := prop_ch_cons * units]
View(merge2)
merge2[, ch_demand := (ch_cons*price)/1000000]
merge2[, duty_per_unit <- round(duty_per_unit,4)]
merge2[, new_duty_per_unit <- round(new_duty_per_unit,4)]
merge2[, ch_duty_per_unit <- round(ch_duty_per_unit,4)]
merge2[, duty_prop <- round(duty_prop,4)]
merge2[, prop_ch_price <- round(prop_ch_price,3)]
merge2[, prop_ch_cons <- round(prop_ch_cons,3)]
merge2[, ch_demand <- round(ch_demand,3)]
######################################################
###### STEP (1) MAKE CHANGES TO THE DUTY PER UNIT DATA
######################################################
# create vector of the duty changes, and repeat for on and off trade
changes <- rep(c(beer_duty,cider_duty,wine_duty,spirit_duty,rtd_duty),2)
duties <- cbind(duties_data,changes)
# convert duties from pence into £
duties[, duty := duty/100]
duties[, dutyperlitre := dutyperlitre/100]
litres <- 100
# apply the changes in duty per litre of product/pure alcohol
duties[, perlitres  := ifelse(is.na(dutyperlitre) ,0,1)]
duties[, of_product := ifelse(how_applied == "per litre of product" ,1,0)]
duties[, of_alcohol := ifelse(how_applied == "per litre of pure alcohol" ,1,0)]
duties[perlitres == 1                  , new_dutyperlitre := (1 + changes/100)*dutyperlitre ]
duties[perlitres == 1 & of_product == 1, new_duty := (new_dutyperlitre)/(litres*abv)]
duties[perlitres == 1 & of_alcohol == 1, new_duty := (new_dutyperlitre)/litres]
# apply changes in duty
duties[perlitres == 0, new_duty := (1 + changes/100)*duty]
duties <- duties[,c("product","duty","new_duty","marketshare")]
#### create a product level dataset of duty data
duties[,duty_per_unit     := weighted.mean(duty,w=marketshare)    , by = "product"]
duties[,new_duty_per_unit := weighted.mean(new_duty,w=marketshare), by = "product"]
duties <- duties[,c("product","duty_per_unit","new_duty_per_unit")]
duties <- unique(duties)
duties[,ch_duty_per_unit := new_duty_per_unit - duty_per_unit]
duties[, product := factor(product,
levels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
#########################################################################
##### STEP (2) SELECT YEAR OF ALCOHOL DATA AND FILTER NECESSARY VARIABLES
#########################################################################
alc <- alcohol_data[alcohol_data$year == select_year,]
#### reshape into long form
long <- melt.data.table(alc,
id.vars = "year",
measure.vars = list(c("units_off_beer", "units_off_cider", "units_off_wine", "units_off_spirits", "units_off_rtds",
"units_on_beer" , "units_on_cider" , "units_on_wine" , "units_on_spirits" ,"units_on_rtds"),
c("price_off_beer", "price_off_cider", "price_off_wine", "price_off_spirits", "price_off_rtds",
"price_on_beer" , "price_on_cider" , "price_on_wine" , "price_on_spirits" ,"price_on_rtds")
),
variable.name = "product",
value.name = c("units","price"))
long[, product := factor(product,
levels = c(1:10),
labels = c("off_beer","off_cider","off_wine","off_spirits","off_rtds",
"on_beer" ,"on_cider" ,"on_wine" ,"on_spirits" ,"on_rtds"))]
#### merge duties to the price and consumption data and then to the elasticities
merge1 <- merge.data.table(long,duties,by = "product")
#########################################################################
##### STEP (3) APPLY ELASTICITIES MATRIX ################################
#########################################################################
if (allow_cross == "Yes") {
elasticities <- as.matrix(elasticities_data[cross == "Yes",-c("cross")])
} else if (allow_cross == "No") {
elasticities <- as.matrix(elasticities_data[cross == "No",-c("cross")])
}
# calculate duty per unit as a proportion of total price per unit
# formula for the change in price: Prop Ch Price = (duty % of price) * Prop Ch Duty
merge1[,duty_prop := duty_per_unit/price]
merge1[,prop_ch_price := duty_prop*(ch_duty_per_unit/duty_per_unit)]
# formula for the change in consumption:
#     prop Ch Cons = elasticity * Prop Ch Price
#     Ch Cons = elasticity * Prop Ch Price * Consumption
prop_ch_price <- as.matrix(merge1$prop_ch_price)
prop_ch_cons  <- elasticities %*% prop_ch_price
merge2 <- data.table(merge1,prop_ch_cons)
setnames(merge2,"V1","prop_ch_cons")
merge2[, ch_cons := prop_ch_cons * units]
## change in final demand = price * ch consumption (in millions of pounds)
merge2[, ch_demand := (ch_cons*price)/1000000]
## round figures
merge2[, duty_per_unit     := round(duty_per_unit,4)]
merge2[, new_duty_per_unit := round(new_duty_per_unit,4)]
merge2[, ch_duty_per_unit  := round(ch_duty_per_unit,4)]
merge2[, duty_prop         := round(duty_prop,4)]
merge2[, prop_ch_price     := round(prop_ch_price,3)]
merge2[, prop_ch_cons      := round(prop_ch_cons,3)]
merge2[, ch_demand         := round(ch_demand,3)]
View(merge2)
data <- CleanFinalDemand(merge2)
data
data <- merge2
data[product %in% c("off_beer","off_cider","off_wine","off_spirits","off_rtds"), name := "off"]
data[product %in% c("on_beer","on_cider","on_wine","on_spirits","on_rtds"), name := "on"]
data[product %in% c("FM_cigs","RYO_tob"), name := "tobacco"]
data[, name := factor(name,levels = c("off","on","tobacco"))]
View(data)
devtools::document()
FAI = TRUE
if (FAI == TRUE) {
flowtable <- as.matrix(tobalciomodel::data_iotable_fai[,grep("^[sec]", names(tobalciomodel::data_iotable_fai), value=TRUE)])
total.output <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"total.output"]))
hhold.demand <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"hhold.demand"]))
hhold.output <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"hhold.output"]))
gva.total    <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"gva.total"]))
gva.taxes    <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"gva.taxes"]))
gva.wages    <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"gva.wages"]))
gva.gos      <- as.vector(as.matrix(tobalciomodel::data_iotable_fai[,"gva.gos"]))
} else if (FAI == FALSE) {
flowtable <- as.matrix(tobalciomodel::data_iotables_ons[year == select_year,-c(1,107:117)])
total.output <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"total.output"]))
hhold.demand <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"hhold.demand"]))
hhold.output <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"hhold.output"]))
gva.total    <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"gva.total"]))
gva.taxes    <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"gva.taxes"]))
gva.wages    <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"gva.wages"]))
gva.gos      <- as.vector(as.matrix(tobalciomodel::data_iotables_ons[year == select_year,"gva.gos"]))
}
## Calculate coefficient matrix:
A <- flowtable %*% ((total.output )^-1 * diag(length(total.output)))
A <- round(A,5)
# Show A
# Identity matrix minus A
IminusA <- diag(length(total.output)) - A
# Calculate the Leontief Inverse matrix
L <- solve(IminusA)
L <- round(L,5)
total.hhold.income <- sum(hhold.demand)
flow.table2 <- rbind(flowtable,hhold.output)        # add employment earnings as an extra row
flow.table2 <- cbind(flow.table2,c(hhold.demand,0))  # add household spending as an extra column (0 for no inter-household purchases)
## Calculate coefficient matrix:
A2 <- flow.table2 %*% (( c(total.output,total.hhold.income) )^-1 * diag(length( c(total.output,total.hhold.income)  ) ) )
A2 <- round(A2,5)
# Identity matrix minus A
IminusA2 <- diag(length(c(total.output,sum(total.output)))) - A2
# Calculate the Leontief Inverse matrix
L2 <- solve(IminusA2)
L2 <- round(L2,5)
View(L2)
output.multipliers.type0 <- rep(1,length(total.output))
output.multipliers.type1 <- rep(NA,length(total.output))
output.multipliers.type2 <- rep(NA,length(total.output))
for (i in 1:length(total.output)) {
output.multipliers.type1[i] <- sum(L[,i])
output.multipliers.type2[i] <- sum(L2[,i])
}
output.multipliers.type2
output.multipliers.type1
library(tobalciomodel)
help(package = tobalciomodel)
data <- tobalciomodel::employment
View(data)
write.csv(data)
?write.csv
write.csv(data,file = "C:/Users/cm1djm/Documents/employment.csv")
